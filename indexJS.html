<!--/*Test HTML
    Copyright (C) 2024  Jakub Sowula, Gabriel Sokalla, Robert Krzywdziński, Mateusz Aleksander, Kacper Zając*/-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        :root {
            --dark-bg: #3c3836;
            --light-bg: #ebdbb2;

            --set-bg: var(--dark-bg);
            --set-fg: var(--light-bg);
            --brightness: 130%;
            --saturation: 500%;
            --hue: -20deg;
            --bright-push: 10%;
            --sat-push: 250%;
        }
    </style>
    <script src="autorun.js"></script>
    <link rel="stylesheet" href="dataDisplay.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <script src="voivodeships.json"></script>
    <script src="powiaty.json"></script>
    <script src="gminy.json"></script>
    <script src="cityCorellation.json"></script>
    <script src="gen.json"></script>
    

    
</head>
<body>
    <div id="map"></div>
    <div id="labels"></div>
    
    <script src="config.js"></script>
    <script src="dataRequests.js">var weatherData = requestData();</script>
    <script src="dataDisplay.js"></script>
    <script>
        var actMap;
        var map;

        var voivodeships;
        var powiats;
        var gminas;

        var retryCount = 0;
        
        function onZoomAnim(e) {
            let target = e.target;
            let zoom = target.getZoom();
            let pixelBounds = target.getPixelBounds();
            let minLatLng = target.unproject(pixelBounds["min"], zoom);
            let maxLatLng = target.unproject(pixelBounds["max"], zoom);
            let diffLatLng = L.latLng(minLatLng["lat"]/maxLatLng["lat"], maxLatLng["lng"]/minLatLng["lng"])
            let diffAvg = (diffLatLng["lat"] + diffLatLng["lng"])/2;
            setBorders(Math.round(borderLevel(diffAvg)), target);
            console.log(diffAvg);
        }

        function entryPoint() {
            if(weatherData == null || weatherData == undefined || weatherData == {}) {
                if(retryCount >= 5) {
                    document.write("ERROR, Server not responding!<br>Please try again later<br>If the problem persists please contact kripkrep@gmail.com<hr>");
                    return 1;
                }
                setTimeout(() => entryPoint(), 1000);
                ++retryCount;
                return 1;
            }
            voivodeships = new L.GeoJSON(voiv, {style: styleVoivodeships});
            powiats = new L.GeoJSON(powiat, {style: stylePowiats});
            gminas = new L.GeoJSON(gmina, {style: styleGminas});

            console.log(document.body.style);

            map = L.map('map').setView([51.919438, 19.145136], 6);
            map.createPane('labels');
            map.getPane('labels').style.zIndex = 650;
            map.getPane('labels').style.pointerEvents = 'none';
            document.getElementById("map").style.filter = colorMode == "dark" ? "sepia(100%)" : "";

            actMap = L.tileLayer('https://{s}.basemaps.cartocdn.com/' + colorMode + '_nolabels/{z}/{x}/{y}.png', {attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>, &copy; <a href="https://carto.com/attributions">CARTO</a>'});
            actMap.addTo(map);

            var labels = L.tileLayer('https://{s}.basemaps.cartocdn.com/' + colorMode + '_only_labels/{z}/{x}/{y}.png', {attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>, &copy; <a href="https://carto.com/attributions">CARTO</a>', pane: 'labels'});
            labels.addTo(map);

            let cornerltpl = L.latLng(54.84+1, 14.12-1);
            let cornerrbpl = L.latLng(49-1, 24.14585+1)
            let bounds = L.latLngBounds(cornerltpl, cornerrbpl);
            map.setMaxBounds(bounds);
            map.on("zoom", onZoomAnim);

            voivodeships.addTo(map);
            document.getElementById("map").style.filter = colorMode == "dark" ? "sepia(20%)" : "sepia(0%)";
        }
        setTimeout(() => entryPoint(), 1000)
    </script>
    <script src="accessBar.js"></script>
    <div id="accessBar">
        <button id="modeButton" class="accButton" onclick="onClickBLeft()"><img src="images/lightbulbOn.png" alt="Lightbulb On"></button>
    </div>
</body>
</html>